В этом уроке разберем, что такое cookies, и научимся использовать их в Flask.

## Что такое cookies

**Cookies** или **куки** — это механизм протокола HTTP, который используется браузером, чтобы хранить данные. Они позволяют отслеживать или идентифицировать возвращающихся посетителей. Куки — это единственный надежный способ понять, что перед нами тот же пользователь. Хотя и в этом случае можно своровать чужие куки и подделать запрос от другого пользователя.

Куки использует не только сам сайт, но и всевозможные виджеты, которые встраиваются на разные странички. Именно благодаря кукам, гугл узнает нас и преследует рекламой того, что мы недавно искали.

## Как использовать куки в Flask

В Flask для работы с куками существует метод `cookies`, через который извлекаются куки из запроса:

```
@app.route('/example')
def example():
    # Вернет содержимое куков foo или None при его отсутствии
    foo = request.cookies.get('foo')
    # ...
    return render_template(...)
```

Чтобы установить куки, необходимо воспользоваться методом `set_cookie(name, value)`. Он добавляет любые куки в ответ:

```
@app.route('/example')
def example():
    # Set-Cookie: <cookie-name>=<cookie-value>
    response = make_response(render_template(...))
    response.set_cookie('foo', 'the bar')
    return response
```

Типичный вариант использования кук — корзина в интернет-магазине. Когда пользователь добавляет товар, код магазина формирует куку, в которую начинает заносить данные о заказе:

```
@app.route('/cart-items')
def cart_items():
    # Информация о добавляемом товаре
    item = request.args.get('item')

    # Данные корзины
    cart = json.loads(request.cookies.get('cart', json.dumps([])))

    # Добавление нового товара
    cart.append(item)

    # Кодирование корзины
    encoded_сart = json.dumps(cart)

    # Установка новой корзины в куку
    response = make_response(redirect('/'))
    response.set_cookie('cart', encoded_сart)
    return response
```

Кука с точки зрения HTTP содержит значение в виде строки. Значит, чтобы хранить составные структуры, нужно проводить ручное кодирование в строку и декодирование при извлечении. Иногда простого кодирования недостаточно, особенно если у данных повышенная важность и их желательно защитить. В таких случаях дополнительно применяют шифрование на стороне сервера.

У кук существует ограничение на количество данных, которые в них можно хранить. Оно равно 4 кб. Для корзины интернет-магазина этого хватит с головой, но в других ситуациях может понадобиться больше места. В этом случае придется воспользоваться сессией, работать с которой мы научимся в следующем уроке.

---

#### Самостоятельная работа

1.  Переделайте способ хранения пользователей на cookie

---

#### Дополнительные материалы

1.  [Официальная документация](https://flask.palletsprojects.com/quickstart/#cookies)